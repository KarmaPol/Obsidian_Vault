## 1단계. 문제 이해 및 설계 범위 확정
- 기능
  - URL 단축
  - URL 리디렉션
  - 높은 가용성, 규모 확장성, 장애 감내 요구
- 개략적 추정
  - 매일 1억개 단축 URL 생성 -> 읽기 연산은 쓰기의 10퍼센트로 가정
  - 10년 운영 시 3650억 개 레코드 보관
  - 축약 전 평균 길이 100
  => 3650억 * 100바이트 = 36.5TB
## 2단계. 개략적 설계안 제시 및 동의 구하기
### API 엔드포인트
1. URL 단축용 엔드포인트
   POST /api/data/shorten
2. URL 리디렉션용 엔드포인트
   GET /api/v1/shortUrl
### URL 리디렉션
단축 URL을 받은 서버는 원래 URL로 바꿔서 Location헤더에 넣고 301 응답으로 반환
- 301 영구 이동
  영구적으로 이전되었으므로 이 응답 캐시
  서버 성능 상 이점
- 302 일시 이동
  캐시 X, 항상 단축 URL에 보내고 리디렉션
  트래픽 분석이 중요할 시 클릭 발생률, 발생 위치 추적에 유리
### URL 단축
URL을 해시값으로 대응할 해시 함수는 다음 요구사항을 만족해야한다
- URL이 다른 값이면 해시 값도 달라야한다
- 계산된 해시 값은 원래 입력으로 주어졌던 긴 URL로 복원될 수 있어야 한다
## 3단계. 상세 설계
### 데이터 모델
{단축 URL, 원래 URL} 쌍을 RDB에 저장
### 해시 함수
#### 해시 길이
단축 URL에 사용될 수 있는 문자는 0~9, A~z로 총 62개
62^n >= 3650억 을 만족하는 n의 최솟값을 찾아야 한다 -> n=7일때 3.5조개
=> 단축 URL의 길이는 7
#### 해시 후 충돌 해소 전략
CRC32, MD5, SHA-1같은 잘 알려진 해시 함수를 사용
-> 길이가 7보다 길기때문에 앞글자 7개만 사용
-> 이때 충돌할 확률이 높아지므로 충돌 발생 시 사전에 정한 문자열을 추가
이때 충돌을 검증하기 위해 DB 질의를 해야하므로 오버헤드가 크다 => 블룸 필터 사용

**충돌이 가능하므로 해소가 필요하고, ID 생성기가 필요하지 않음**
#### base-62 변환 전략
유일성 보장 ID 생성기에 의해 생성된 ID를 62진법으로 단축
hash에 사용할 수 있는 문자 갯수가 62개이므로 변환이 간단하다
11157(10) -> 2, 55, 59 -> 2, T,X => 2TX(62)

**길이가 가변적
따로 유일성 보장 ID 생성기가 필요하고, 다음에 쓸 단축 URL을 유추할 수 있음**
### URL 단축기 상세 설계
입력된 URL이 이미 DB에 있다면 조회
없으면 유일 ID 생성기에서 새로운 ID 생성 -> 단축 URL로 변환 -> DB에 레코드로 저장
## 4단계. 마무리
### 논의사항
- 처리율 제한 장치
  엄청난 양의 URL 단축 요청이 들어오면 무력화될 수 있음
- 웹 서버의 규모 확장
- DB의 규모 확장
- 데이터 분석 솔루션(analytics)
- 가용성, 데이터 일관성, 안정성