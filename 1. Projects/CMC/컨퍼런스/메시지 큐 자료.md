- 메시지 큐 개요
  https://tecoble.techcourse.co.kr/post/2021-09-19-message-queue/
- 카프카
  https://hudi.blog/what-is-kafka/
- 배민 주문시스템의 5년간의 변화과정
  -> 아직 영상 자료는 없는데, CQRS 패턴 + 도메인 분리하고 메시지 큐로 비동기
- 카프카를 적용한 이벤트 프로그래밍 코드 예시를 간략하고 가독성 좋게 보여주면 좋을거 같다
- RABBITMQ vs KAFKA
  https://dkswnkk.tistory.com/705
- 인프런 카프카 입문
  https://www.inflearn.com/course/아파치-카프카-입문



msa 배민 eda + 유튜브 영상 처리 작업 큐
https://sihyung92.oopy.io/architecture/woowa-msa-travel

크리스마스 경품 이벤트 트래픽 대응 -> nGrinder로 실제 트래픽 테스트 해서 이미지 대조

#### 영상처리 작업 큐
영상을 업로드할 수 있는 서비스가 있다고 가정
비동기적으로 처리할 수 있음
서버 간 결합도를 낮추고 확장성
### MSA (EDA)
최근 MSA가 주목
서버 간 소통을 위한 REST API 호출 빈번
이때 API 장애 발생 시 다른 시스템도 영향

메시지 큐를 이용해 EDA 추가 도입 가능
=>
다른 시스템에 대해 자세히 알 필요가 없어지고 이벤트 발행만 하면됨 (의존성)
리뷰 시스템 다운되더라도 복구 되었을때 메시지 큐에서 재수신하여 처리 가능 (장애 처리)
### 적용 사례
1. 크리스마스 경품 지급 이벤트
2. 대규모 트래픽 발생
3. WAS에서 경품 처리 로직도 처리하면 병목
4. 경품 지급 로직 모듈을 분리
5. 카프카로 연결
6. 병목 현상 해결 -> nGrinder로 보여준다

개념 - 5분
사용 이유 - 5분
종류 - 7분
사례 - 3분
총평 - 1분

12/10 피드백 반영
12/20 ~ 대본, 발표 연습

## 대본
7. 다음으로 메시지 큐의 사용 이유에 대해 알아보겠습니다
   최근 웹 상에서 더 복잡한 서비스를 제공하면서 메시지큐는 더 각광받고 있습니다
   영상을 업로드할 수 있는 서비스를 예를 들어 설명하겠습니다.
   웹서버와 영상 처리 작업서버가 동기적으로 연결되어 있다면,
   다음 작업을 처리하기 위해 영상 처리 작업을 기다려야 합니다.
   이로 인해 병목 현상이 발생 할 수 있고, 이는 전체적인  서비스의 품질 저하로 이어집니다.
8. 따라서 웹 서버와 영상 처리 작업 서버 사이에 메시지 큐를 배치하면 이를 방지할 수  있습니다.
   동기적 연결에서 메시지 큐를 통해 비동기 연결로 전환하여,
   웹 서버는 메시지 큐에 영상 처리 작업 메시지를 전달하고 더이상 신경쓰지 않아도 되고,
   영상 처리 작업 서버는 작업 처리 속도에 맞게 메시지 큐에서 메시지를 가져올 수 있습니다.
   결과적으로 메시지 큐로 서버 간 결합을 낮추어 병목 현상을 해결할 수 있습니다.
9. 또한 주문, 회원, 쿠폰, 리뷰 시스템으로 이루어진 MSA 시스템이 있다고 가정해보겠습니다.
10. 주문 시스템에서 통신을 위해 REST API를 호출할 경우, 네트워크 장애나 잘못된 API 호출로 인해 리뷰 시스템은 정상적인 요청을 받지 못하여 전체 시스템의 장애로 이어질 수 있습니다.
11. 이를 해결하기 위해, 카프카나 아마존 SQS와 같은 메시지 큐를 사용할 수 있습니다.
    통신으로 API를 직접 호출하는 대신, 주문 시스템에서 이벤트를 발행하면 각 시스템에서 이를 구독하는 구조로 주문 시스템은 더이상 다른 시스템에 대해 알 필요가 없습니다.
    이러한 구조를 이벤트 기반 아키텍처라고 합니다.
12. 다음으로 주문 시스템에서 정상적으로 이벤트를 발행했음에도, 리뷰 시스템에 장애가 발생해 이를 처리하지 못한 상황을 가정해보겠습니다.
13. 리뷰 시스템이 정상화된 뒤, 메시지 큐에 있는 실패한 이벤트부터 꺼내오면 처리를 성공적으로 완료할 수 있습니다. 따라서 메시지 큐를 사용하면 장애 대응에도 이점이 있다는 걸 알 수 있습니다.

21. 다음으로 메시지 큐 적용 사례를 크리스마스 이벤트 시나리오를 통해 알아보겠습니다.
    한 커머스 서비스에서 크리스마스 당일에 기프티콘을 무료로 제공하는 이벤트를 진행하여, 이벤트에 참여하는 유저가 몰린 상황입니다.
22. 유저가 서버에 기프티콘 발급 요청을 보내면 서버는 발급 처리하여 이를 DB에 저장합니다
23. 이 때 한꺼번에 요청이 몰릴 경우, DB 서버의 처리량보다 요청이 많다면 타임아웃 혹은 서버 부하로 인한 장애가 발생하여 전체 서비스의 장애로 이어질 수 있습니다.
24. 따라서 커머스 서비스를 사용하는 일반 유저도 서비스 장애로 인해 정상적인 사용을 할 수 없게되어, 매출이나 서비스 이미지에 큰 타격을 받을 수 있습니다.
25. 이를 해결하기 위해, 메인 서버와 기프티콘 발급 서버를 분리하고 메시지 큐를 통해 두 서버를 비동기적으로 연결한다면 서버 부하를 줄일 수 있고, 대규모 트래픽에 대응하기에 더 유연한 구조를 만들 수 있습니다.