# 트레이드 오프와 탈착형 수집기
- GC는 탈착형, 완벽한 범용형은 없음
	- 중단시간
	  -> 예로 배치 처리 시스템은 중단시간보다 처리율이 중요
	- 처리율
	- 중단 빈도
	- 회수 효율
	- 중단 일관성
# 동시 GC 이론
- GC 개입 시점을 알수 없다
## JVM 세이프 포인트
 - 세이프 포인트
   스레드 내부 자료 구조가 노출된 지점
- 어플리케이션 스레드들은 thread barrier에 도달해 대기, 지속적으로 폴링하며 체크
### JVM 세이프 포인트 규칙
1. JVM은 스레드를 강제로 세이프포인트 상태로 바꿀수 없다
2. JVM은 스레드가 세이프포인트 상태에서 벗어나지 못하게 할 수 있다
### 삼색마킹 알고리즘
- 회색마크 순회하며 자식 노드에 회색마크 퍼뜨리고, 검정마크로 방문 체크
- 병렬 작업시, 검정마크와 연결된 흰색마크 객체가 새로 생성되어 문제발생
  -> 변경자 스레드가 검정마크- 회색으로 수정
## CMS 수집기
- 중단 시간을 아주 짧게 하게 하려고 설계된 테뉴어드용 GC
- **어플리케이션 스레드와 같이 작동**, 따라서 처리율, 중단시간 낮음 -> 저지연 어플리케이션에 특화
- 단편화를 하지 않음, 조기승격이 너무 잦아 테뉴어드도 부족한 경우(CMF) 
  => ParallelOld GC로 풀STW
```java
-XX:+UseConcMarkSweepGC
```
# G1 수집기
[로그로 G1 동작 확인하기](https://chaewsscode.tistory.com/261)
- 자바8 이후의 GC, 오라클에서 집중
- CMS 보단 중단시간이 길다
### 장점
- CMS보다 훨씬 튜닝하기 쉬움
- 조기 승격에 덜 취약
- **중단시간 적고**, FULL STW 거의 없음
## G1 힙 레이아웃 영역
- Region
  힙 내부 1 MB(default) 메모리 공간
- 힙을 Region으로 나누어 각 **세대별 불연속 배치** 가능
## G1 알고리즘 설계
- G1은 가비지를 얼마나 수집할수 있는지 통계적으로 추측해 할당과 비교
- 기존 카드테이블과 유사하게 Rset 사용, 레퍼런스 저장
## G1 단계
1. 초기 마킹 STW
2. 동시 루트 탐색
3. 동시 마킹
4. 재마킹 STW
5. 정리 STW
# 셰난도아
