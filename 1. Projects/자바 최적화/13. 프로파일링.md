# 프로파일링
- 접근 방식
  1. 실행
  2. 할당
## 개요
- CPU, 메모리 분석
- 실행 프로파일링의 목표는 리팩터링 및 성능 최적화 대상 코드 식별
- **프로파일링 전에 반드시 어떤 것이 원인인지 파악부터**
  -> 성능 원인이 애플리케이션 코드임을 입증해라
## 세이프포인트 편향
- 샘플링 하기전에 모든 스레드가 세이프 포인트에 있어야 하므로
  표본점 분포가 왜곡될 수 있음
- JVM 플래그로 세이프 포인트에서 얼마나 시간이 소요되는지 확인 가능
## 프로파일링 툴
- VisualVM, JProfiler 등 여러 툴을 통해 스택트레이스를 따라 메서드 별 스레드 실행 시간 등을 측정 가능
-> MSA에선 Open Telemetry 기반 + a 주로 사용
## 할당 프로파일링
- 실행 프로파일링의 비중이 크지만, 메모리 할당 프로파일링도 중요

- NEW, NEWARRAY, ANEWARRAY 바이트코드가 실행될때마다 추적해 할당을 기록할 수 있다
- 하지만 전체 성능에 영향을 줄 수 있음 -> TLAB 샘플링 추정 방식
## 힙덤프 분석
- 힙 스냅샷을 뜯어보며 분석
  1. 메모리 누수
  2. OOM
  3. GC 최적화
- 하지만 메모리 크기의 300~400%가 되는 일이 부지기수고 STW 월드 유발
- G1GC를 쓰면 더 빠르다
### 느낀 점
- 어플리케이션의 병목 지점을 파악하기 좋겠다
[[9. JVM의 코드 실행]]